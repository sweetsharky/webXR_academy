<!DOCTYPE html>
<html lang="en">

<head>
	<title>3D Model</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<link type="text/css" rel="stylesheet" href="style.css">
  <script src="https://unpkg.com/three@0.133.0/build/three.js" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/three@0.133.0/examples/js/loaders/GLTFLoader.js"></script>
<style>

    .grid-container {
      display: none; /*wird bei sessionstart durch den ARButton in display: grid; verändert*/
      grid-template-columns: 80% 20%;
      grid-template-rows: 1fr 4fr 2fr;
      gap: 0.2em;
      width: 100vw; /* volle Breite */
      height: 100vh; /* volle Höhe */
      background-color: rgba(255, 255, 255, 0.212);
      padding: 1em;
      border-radius: 0.5em;
      box-sizing: border-box;
		overflow: hidden; /* verhindert Scrollen überall */
    }

    .grid-container>div {
      color: #000;
      padding: 0.5em;
	  margin-right: 1em;
      border-radius: 0.5em;
      font-size: 1em;
      text-align: center;
    }

    .item1 {
      grid-column-start: 1;
      grid-column-end: 3;
    }

    .item2 {
      background-color: orange;
    }

    .item3 {
      background-color: orange;
    }

    .item4 {
	background-color: orange;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 1em;
    }
    
  #textBox {
    text-align: left;
    word-wrap: break-word;
  }

  .item5 {
    background-color: orange;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hide {
  display: none !important;
}


	/*Quiz-Buttons innerhalb eines flex-Layouts (siehe .answers)*/
	.quiz-button {
  position: relative; /* wichtig! .quiz-button:after ist ein pseudo-element, das absolut positioniert wird. Deshalb muss der Eltern-Button .quiz-button auf position: relative gesetzt werden, damit sich der Effekt nur innerhalb des Buttons ausbreitet. Ansonsten überlagert der Effekt den ganzen Bildschirm*/
  background-color: #04AA6D;
  border: none;
  border-radius: 0.5em;
  font-size: 1em;
  color: #FFFFFF;
      padding: 1em;
  width: 60%;
  text-align: center;
  transition-duration: 0.4s;
  text-decoration: none;
  overflow: hidden;
  cursor: pointer;
}

.quiz-button:after {
  content: "";
  background: #f1f1f1;
  display: block;
  position: absolute;
  padding-top: 300%;
  padding-left: 350%;
  margin-left: -1em !important;
  margin-top: -120%;
  opacity: 0;
  transition: all 0.8s
}

.quiz-button:active:after {
  padding: 0;
  margin: 0;
  opacity: 1;
  transition: 0s
}

.answers {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    align-items: center;
  }
	/*Quiz-Buttons Ende*/

  /*Hinweis-Icons*/
.icon-column {
    display: flex;
    flex-direction: column;
    gap: 10px;
    width: 100%;
    align-items: center;
  }
  /*Hinweis-Icons Ende*/
</style>

</head>

<body>
	<script type="module">
    import { ARButton } from 'https://unpkg.com/three@0.133.0/examples/jsm/webxr/ARButton.js';
    
		let camera, scene, renderer;
		let loader; // we need to create a variable for a gltf model loader
    let model; // das geladene 3D-Model wird hierdrunter gespeichert

		init();
		animate();


		function init() {
			const container = document.createElement('div');
			document.body.appendChild(container);

			scene = new THREE.Scene();

			camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 40);

			renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.xr.enabled = true; // we have to enable the renderer for webxr
			container.appendChild(renderer.domElement);

			var light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
			light.position.set(0.5, 1, 0.25);
			scene.add(light);

      // specify a model URL
      const modelUrl = 'https://raw.githubusercontent.com/sweetsharky/media/refs/heads/main/metallobjekt/metallobjekt.gltf'; 
      
			// create a GLTF loader object. GLTF is a 3D model format usually called the "JPEG of 3D" because it is
      // fast and efficient to use, which is ideal for the web
			loader = new THREE.GLTFLoader();
      
      // learn about other types of 3D model formats you can use here: 
      // https://threejs.org/docs/#manual/en/introduction/Loading-3D-models
      
      // load the model
      // loader takes in a few arguments loader(model url, onLoad callback, onProgress callback, onError callback)
			loader.load(
				// model URL
				modelUrl,
				// onLoad callback: what get's called once the full model has loaded
				function (gltf) {
          // gltf.scene contains the Three.js object group that represents the 3d object of the model
					model = gltf.scene;
          scene.add(model);
          console.log("Model added to scene");
          

		  // scaling model
		  model.scale.multiplyScalar(0.002);
          // you can optionally change the position of the model
            model.position.z = -0.3; // negative Z moves the model in the opposite direction the camera is facing
           model.position.y = 0; // positive Y moves the model up
            model.position.x = 0; // positive X moves hte model to the right
			},


				// onProgress callback: optional function for showing progress on model load
				//function (xhr) {
		      // console.log((xhr.loaded / xhr.total * 100) + '% loaded' );},
				
			 
			  // onError callback
				function (error) {
					console.error(error);
				}
			);

			document.body.appendChild(ARButton.createButton(renderer, {
				optionalFeatures: ["dom-overlay", "dom-overlay-for-handheld-ar"],
          		domOverlay: { root: document.body}
			}));


// Wenn eine AR-Session startet → UI einblenden
  renderer.xr.addEventListener('sessionstart', () => {
    document.querySelector('.grid-container').style.display = 'grid';
  });

  // Wenn AR-Session beendet → UI ausblenden
  renderer.xr.addEventListener('sessionend', () => {
    document.querySelector('.grid-container').style.display = 'none';
  });

  			//Button, um UI-Panel(grid-Layout) zu sichtbar zu machen/unsichtbar
document.getElementById('toggle-panel').addEventListener('click', () => {
  document.querySelector('.grid-container').classList.toggle('hide');
});

			window.addEventListener('resize', onWindowResize, false);
		}

// Anpassung bei Fenstergröße ändern → Kamera, Renderer und Grid
function onWindowResize() {
    // Three.js anpassen
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);

    
}
/*function init() zuende*/


		function animate() {
			renderer.setAnimationLoop(render);
		}

		function render() {
			renderer.render(scene, camera);
		}

	</script>

<div class="grid-container">
  <div class="item1">Auf den Spuren der Wikinger in Duisburg</div>
  <div class="item2">  
  	<p style="background: green;"></p>Das Objekt, das du siehst ist es ein Teil von...(wähle aus):</p>
  	<div class="answers">
      <button class="quiz-button">einem Schiff</button>
      <button class="quiz-button">einer Waffe</button>
      <button class="quiz-button">einem Wassereimer</button>
    </div>
    </div>
    
  <div class="item3">3
    <div class="icon-column">
      <img src="/webXR_academy/staticfiles/images/feuerstahlbeschlag_duisburg_einzeln.svg" alt="Feuerstahlbeschlag" width="10"/>
      <img src="/webXR_academy/staticfiles/images/feuerstahlbeschlag_duisburg_einzeln.svg" alt="Feuerstahlbeschlag" width="10"/>
    </div>
  </div>  
  
  <div class="item4">
  	<div id="textBox"></div>
    </div>
    
  <div class="item5">
   <button id="nextButton" class="button" style="display:none;">Weiter</button>
  

</div>
  <button id="toggle-panel">Toggle Panel</button></div>

<!-- Script für Textleiste unten, um Typewriter-Effekt, Pagination und Overflow-Handling des Textes hinzubekommen.-->
<script>
const fullText = `Ist es ein Teil von...(wähle aus): Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum.`;

const charsPerPage = 100; // Anzahl Zeichen pro "Seite" (kannst du anpassen)
let currentPage = 0;

const textBox = document.getElementById('textBox');
const nextButton = document.getElementById('nextButton');

function typeWriterEffect(text, callback) {
  let i = 0;
  textBox.textContent = "";
  const interval = setInterval(() => {
    textBox.textContent += text[i];
    i++;
    if (i >= text.length) {
      clearInterval(interval);
      callback();
    }
  }, 30); // Geschwindigkeit (ms pro Buchstabe)
}

function showPage(pageIndex) {
  const start = pageIndex * charsPerPage;
  const end = start + charsPerPage;
  let pageText = fullText.slice(start, end);
  
  // Falls nicht am Ende, füge "..." hinzu
  if (end < fullText.length) {
    pageText += "...";
  }
  
  typeWriterEffect(pageText, () => {
    // Falls noch mehr Text existiert → Button anzeigen
    if (end < fullText.length) {
      nextButton.style.display = "block";
    } else {
      nextButton.style.display = "none";
    }
  });
}

nextButton.addEventListener('click', () => {
  currentPage++;
  nextButton.style.display = "none";
  showPage(currentPage);
});

// Start bei Seite 0
showPage(0);
</script>


</body>

</html>